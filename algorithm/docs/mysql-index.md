# MySQL数据库索引

## B+ 树
* 每个节点中子节点的个数不能超过 m，也不能小于 m/2；
* 根节点的子节点个数可以不超过 m/2，这是一个例外；
* m 叉树只存储索引，并不真正存储数据，这个有点儿类似跳表；
* 通过链表将叶子节点串联在一起，这样可以方便按区间查找；
* 一般情况，根节点会被存储在内存中，其他节点存储在磁盘中。

>q:我们给一亿个数据构建二叉查找树索引，那索引中会包含大约 1 亿个节点，每个节点假设占用 16 个字节，
> 那就需要大约 1GB 的内存空间。给一张表建立索引，我们需要 1GB 的内存空间。如果我们要给 10 张表建立索引，那对内存的需求是无法满足的。
> 如何解决这个索引占用太多内存的问题呢？
>
>a：我们可以借助时间换空间的思路，把索引存储在硬盘中，而非内存中。优化的重点就是尽量减少磁盘 IO 操作，也就是，尽量降低树的高度。m 叉树。
> 不管是内存中的数据，还是磁盘中的数据，操作系统都是按页（一页大小通常是 4KB，这个值可以通过 getconfig PAGE_SIZE 命令查看）来读取的，
> 一次会读一页的数据。如果要读取的数据量超过一页的大小，就会触发多次 IO 操作。
> 所以，我们在选择 m 大小的时候，要尽量让每个节点的大小等于一个页的大小。读取一个节点，只需要一次磁盘 IO 操作。

>q:为什么 MySQL 的索引要使用 B+ 树而不是其它树形结构
> 
>a:因为 B 树不管叶子节点还是非叶子节点，都会保存数据，这样导致在非叶子节点中能保存的指针数量变少（有些资料也称为扇出），指针少的情况下要保存大量数据，
> 只能增加树的高度，导致 IO 操作变多，查询性能变低。

>q:MyISAM vs InnoDB
> 
>a:数据和索引的组织方式不同。MyISAM将索引和数据分开进行存储。索引存放在.MYI文件中，数据存放在.MYD文件中。索引中保存了相应数据的地址。
> 以表名+.MYI文件分别保存。 InnoDB的主键索引树的叶子节点保存主键和相应的数据。其它的索引树的叶子节点保存的是主键。也正是因为采取了这种存储方式，
> InnoDB才强制要求每张表都要有主键。
> 
> MyISAM和InnoDB都是以B+树数据结构存储数据的，但MyISAM的数据文件和索引文件是分开的，InnoDB的数据文件就是索引文件。
> MyISAM主索引中的B+树中，叶节点的data域存放的是数据记录的地址，而InnoDB中的叶子节点叶节点data域保存了完整的数据记录。
> MyISAM辅助索引中的B+树中，叶节点的data域存放的是数据记录的地址，而InnoDB中的叶子节点叶节点data域保存的是主键的值。

## B 树
* B+ 树中的节点不存储数据，只是索引，而 B 树中的节点存储数据；
* B 树中的叶子节点并不需要链表来串联。

## 参考
* [**数据结构与算法之美**](http://gk.link/a/10p9l)
* https://ahcming.github.io/2019/04/04/mysql-innodb
* https://zhuanlan.zhihu.com/p/86137284
* https://zhuanlan.zhihu.com/p/149830365